<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–°–æ–±–µ—Ä–∏ —Å–≤–æ–π –¥–æ–º</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    .container { background: #fff; padding: 20px; border-radius: 10px; max-width: 500px; margin: auto; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    select, input, textarea, button { width: 100%; margin: 10px 0; padding: 10px; border-radius: 6px; border: 1px solid #ccc; }
    button { background: #2a9d8f; color: white; font-weight: bold; cursor: pointer; border: none; transition: background 0.3s ease; }
    button:hover { background: #21867a; }
    h2 { text-align: center; }
    #thanks { display: none; text-align: center; color: #2a9d8f; font-weight: bold; }
    #error { display: none; text-align: center; color: red; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h2>–°–æ–±–µ—Ä–∏ —Å–≤–æ–π –¥–æ–º</h2>

    <form id="houseForm">
      <label>–¢–∏–ø –¥–æ–º–∞:</label>
      <select name="–¢–∏–ø –¥–æ–º–∞">
        <option>–ö–∞—Ä–∫–∞—Å–Ω—ã–π</option>
        <option>–ú–æ–¥—É–ª—å–Ω—ã–π</option>
        <option>–ë–∞—Ä–Ω—Ö–∞—É—Å</option>
        <option>A-—Ñ—Ä–µ–π–º</option>
      </select>

      <label>–≠—Ç–∞–∂–Ω–æ—Å—Ç—å:</label>
      <select name="–≠—Ç–∞–∂–Ω–æ—Å—Ç—å">
        <option>1 —ç—Ç–∞–∂</option>
        <option>1.5 —ç—Ç–∞–∂–∞</option>
        <option>2 —ç—Ç–∞–∂–∞</option>
      </select>

      <label>–¢–∏–ø –∫—Ä—ã—à–∏:</label>
      <select name="–¢–∏–ø –∫—Ä—ã—à–∏">
        <option>–û–¥–Ω–æ—Å–∫–∞—Ç–Ω–∞—è</option>
        <option>–î–≤—É—Å–∫–∞—Ç–Ω–∞—è</option>
        <option>–ü–ª–æ—Å–∫–∞—è</option>
      </select>

      <label>–¶–≤–µ—Ç —Ñ–∞—Å–∞–¥–∞:</label>
      <input type="text" name="–¶–≤–µ—Ç —Ñ–∞—Å–∞–¥–∞" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Ç—ë–º–Ω–æ-—Å–µ—Ä—ã–π" />

      <label>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è:</label>
      <textarea name="–ü–æ–∂–µ–ª–∞–Ω–∏—è" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ, —á—Ç–æ –≤–∞–∂–Ω–æ —É—á–µ—Å—Ç—å"></textarea>

      <label>–í–∞—à–µ –∏–º—è:</label>
      <input type="text" name="–ò–º—è" required />

      <label>–ö–æ–Ω—Ç–∞–∫—Ç (Telegram –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω):</label>
      <input type="text" name="–ö–æ–Ω—Ç–∞–∫—Ç" required />

      <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
    </form>

    <div id="thanks">‚úÖ –°–ø–∞—Å–∏–±–æ! –í–∞—à–∞ –∑–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞.</div>
    <div id="error">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12 ‚Üí Console)</div>
  </div>

<script>
// –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã –≤ Telegram + Email (formspree + formsubmit)
const form = document.getElementById("houseForm");
const thanks = document.getElementById("thanks");
const error = document.getElementById("error");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const formData = new FormData(form);
  const data = Object.fromEntries(formData.entries());

  console.log("üß© [DEBUG] üìã –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã:", data);

  try {
    const start = Date.now();
    console.log("[FORM] ‚ñ∂Ô∏è –ù–∞—á–∞–ª–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ 3 —Å–µ—Ä–≤–∏—Å–∞...");

    // 1Ô∏è‚É£ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram —á–µ—Ä–µ–∑ Netlify Function
    console.log("[TELEGRAM] üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram...");
    const telegramPromise = fetch("/.netlify/functions/sendToTelegram", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data),
    }).catch(err => {
      console.error("[TELEGRAM] ‚ùå –û—à–∏–±–∫–∞:", err);
      return { ok: false };
    });

    // 2Ô∏è‚É£ –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –ø–æ—á—Ç—É —á–µ—Ä–µ–∑ Formspree
    console.log("[FORMSPREE] üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Formspree...");
    const formspreePromise = fetch("https://formspree.io/f/xovpgrdb", {
      method: "POST",
      body: formData,
      headers: { Accept: "application/json" }
    }).catch(err => {
      console.error("[FORMSPREE] ‚ùå –û—à–∏–±–∫–∞:", err);
      return { ok: false };
    });

    // 3Ô∏è‚É£ –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –ø–æ—á—Ç—É —á–µ—Ä–µ–∑ FormSubmit
    console.log("[FORMSUBMIT] üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ FormSubmit...");
    const formsubmitPromise = fetch("https://formsubmit.co/ajax/5737c0e3afdf03a3379818dae29080c0", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Accept": "application/json"
      },
      body: JSON.stringify(data)
    }).catch(err => {
      console.error("[FORMSUBMIT] ‚ùå –û—à–∏–±–∫–∞:", err);
      return { ok: false };
    });

    // –û–∂–∏–¥–∞–µ–º –≤—Å–µ —Ç—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
    const [telegramRes, formspreeRes, formsubmitRes] = await Promise.all([
      telegramPromise,
      formspreePromise,
      formsubmitPromise
    ]);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    const telegramOk = telegramRes.ok;
    const formspreeOk = formspreeRes.ok;
    const formsubmitOk = formsubmitRes.ok;

    console.log("[TELEGRAM] " + (telegramOk ? "‚úÖ" : "‚ùå") + " –°—Ç–∞—Ç—É—Å:", telegramRes.status);
    console.log("[FORMSPREE] " + (formspreeOk ? "‚úÖ" : "‚ùå") + " –°—Ç–∞—Ç—É—Å:", formspreeRes.status);
    console.log("[FORMSUBMIT] " + (formsubmitOk ? "‚úÖ" : "‚ùå") + " –°—Ç–∞—Ç—É—Å:", formsubmitRes.status);

    // –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å–ø–æ—Å–æ–± —Å—Ä–∞–±–æ—Ç–∞–ª - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
    if (telegramOk || formspreeOk || formsubmitOk) {
      console.log("[FORM] ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ (—Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å–ø–æ—Å–æ–±)!");
      form.reset();
      form.style.display = "none";
      thanks.style.display = "block";
    } else {
      // –ï—Å–ª–∏ –≤—Å–µ —Ç—Ä–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏
      console.error("[FORM] ‚ùå –í—Å–µ —Å–ø–æ—Å–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏");
      error.style.display = "block";
      setTimeout(() => { error.style.display = "none"; }, 5000);
    }

    console.log(
      `[FORM] üïì –ó–∞–≤–µ—Ä—à–µ–Ω–æ: ${new Date().toLocaleTimeString()} (–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${
        Date.now() - start
      } –º—Å)`
    );
  } catch (err) {
    console.error("[FORM] ‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:", err);
    error.style.display = "block";
    setTimeout(() => { error.style.display = "none"; }, 5000);
  }
});
</script>
</body>
</html>
